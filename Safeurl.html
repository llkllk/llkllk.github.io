<!DOCTYPE html>
<html lang="zh">
<head>
<title>祎开发</title>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<style>
  *{margin:0;padding:0;font-family: "Microsoft YaHei";color: #fff;}
  body,div,form,input,li,ol,p,textarea,ul{margin:0;padding:0;font-family: "Microsoft YaHei";color: #fff;}
  body{background:#fff;color:#3f3f3f;font-family:Apple LiGothic Medium,SimHei,Geneva,Arial,Helvetica,sans-serif;-webkit-tap-highlight-color:transparent;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-appearance:none;width:100%;font-size:12px;}
  body p {color: white;text-align: center;line-height: 25px;}
  #zl{overflow:hidden;}
</style>
</head>
<body style="text-align: center;">
<div id="Zl"><iframe id="preview" src="" frameborder="0" width="100%" height="910px" scrolling='auto'></iframe></div>
<script>
  // 获取 URL 参数
  function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  }

  // 设置 iframe 源地址
  var targetUrl = getUrlParameter('url') || 'https://yidev.cn';

  // 注意：移除 allow-popups-to-escape-sandbox，改为 allow-popups 让弹窗保持在 iframe 内
  $("#Zl").html('<iframe width="100%" id="preview" name="contentFrame" src="' + targetUrl + '" frameborder="0" sandbox="allow-same-origin allow-scripts allow-forms allow-popups"></iframe>');

  $(document).ready(function(){
    function fix_height(){
      $("#preview").attr("height", (($(window).height())-5) + "px");
    }
    $(window).resize(function(){
      fix_height();
    }).resize();

    // 尝试拦截 iframe 内的 window.open（仅在同源时有效）
    var iframe = $("#preview")[0];
    iframe.onload = function() {
      try {
        var iframeWindow = iframe.contentWindow;

        // 保存原始的 window.open
        var originalOpen = iframeWindow.open;

        // 重写 window.open，强制在 iframe 内打开
        iframeWindow.open = function(url, name, features) {
          // 忽略 name 参数，强制在当前窗口打开
          return iframeWindow.location.href = url;
        };

        // 拦截所有链接的 target 属性
        iframeWindow.document.addEventListener('click', function(e) {
          var target = e.target;
          if (target.tagName === 'A') {
            var href = target.getAttribute('href');
            var linkTarget = target.getAttribute('target');

            // 如果是 _blank, _top, _parent，阻止默认行为并在 iframe 内打开
            if (linkTarget === '_blank' || linkTarget === '_top' || linkTarget === '_parent') {
              e.preventDefault();
              iframeWindow.location.href = href;
            }
          }
        }, true);

      } catch (e) {
        // 跨域时会报错，这是正常的
        console.log('无法访问 iframe 内容（跨域限制）:', e.message);
      }
    };

    iframe.contentWindow.focus();
  });
</script>
</br></br></br>
</body>
</html>