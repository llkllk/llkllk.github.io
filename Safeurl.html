<!DOCTYPE html>
<html lang="zh">
<head>
<title>祎开发</title>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<style>
  *{margin:0;padding:0;font-family: "Microsoft YaHei";color: #fff;}
  body,div,form,input,li,ol,p,textarea,ul{margin:0;padding:0;font-family: "Microsoft YaHei";color: #fff;}
  body{background:#fff;color:#3f3f3f;font-family:Apple LiGothic Medium,SimHei,Geneva,Arial,Helvetica,sans-serif;-webkit-tap-highlight-color:transparent;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-appearance:none;width:100%;font-size:12px;}
  body p {color: white;text-align: center;line-height: 25px;}
  #zl{overflow:hidden;}
</style>
</head>
<body style="text-align: center;">
<div id="Zl"><iframe id="preview" src="" frameborder="0" width="100%" height="910px" scrolling='auto'></iframe></div>
<script>
  // 获取 URL 参数
  function getUrlParameter(name) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(location.search);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  }

  // 设置 iframe 源地址
  var targetUrl = getUrlParameter('url') || 'https://yidev.cn';

  // 使用 sandbox 但允许导航，只阻止 top-navigation
  $("#Zl").html('<iframe width="100%" id="preview" name="contentFrame" src="' + targetUrl + '" frameborder="0" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"></iframe>');

  $(document).ready(function(){
    function fix_height(){
      $("#preview").attr("height", (($(window).height())-5) + "px");
    }
    $(window).resize(function(){
      fix_height();
    }).resize();

    // 在 iframe 加载完成后动态插入 <base target="_self">
    var iframe = $("#preview")[0];
    iframe.onload = function() {
      try {
        var iframeWindow = iframe.contentWindow;
        var iframeDoc = iframeWindow.document;

        // 检查是否已经有 base 标签
        var existingBase = iframeDoc.querySelector('base');
        if (existingBase) {
          // 如果已有 base 标签，修改其 target 属性
          existingBase.setAttribute('target', '_self');
        } else {
          // 如果没有，创建新的 base 标签
          var base = iframeDoc.createElement('base');
          base.setAttribute('target', '_self');
          var head = iframeDoc.head || iframeDoc.getElementsByTagName('head')[0];
          if (head) {
            head.insertBefore(base, head.firstChild);
          }
        }

        // 同时拦截 window.open
        var originalOpen = iframeWindow.open;
        iframeWindow.open = function(url, name, features) {
          // 如果是打开新窗口，在当前 iframe 内打开
          if (!name || name === '_blank' || name === '_top' || name === '_parent') {
            iframeWindow.location.href = url;
            return null;
          }
          return originalOpen.call(iframeWindow, url, name, features);
        };
      } catch (e) {
        // 跨域时无法访问，依赖 sandbox 属性限制
        console.log('跨域限制，无法注入 base 标签');
      }
    };

    iframe.contentWindow.focus();
  });
</script>
</br></br></br>
</body>
</html>